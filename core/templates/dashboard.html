{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% load static %}

{% block content %}
<div class="min-h-screen bg-green-50 rounded-xl text-gray-800 px-6 py-8">
    <!-- Welcome Section -->
    <div class="bg-gradient-to-r from-green-700 to-green-600 text-white rounded-xl shadow-lg p-6 mb-10">
        <div class="flex flex-col md:flex-row items-center md:items-start justify-between">
            <div class="mb-4 md:mb-0">
                <h1 class="text-3xl font-extrabold mb-2">Welcome Back, {{ user.username }}!</h1>
                <p class="text-lg italic font-semibold">
                    Cook Smart, <span class="text-yellow-300">Waste Less!</span>
                </p>
            </div>
            <div class="hidden md:block">
                <img src="{% static 'images/eco-dashboard.png' %}" alt="Eco Friendly" class="h-24">
            </div>
        </div>
    </div>

    <!-- Statistics Section -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
        <div class="bg-green-500 hover:bg-green-400 rounded-lg shadow-md p-6 text-center transition">
            <h3 class="text-xl font-semibold text-white">Total Food Items</h3>
            <p class="text-4xl font-extrabold text-yellow-300">{{ food_items|length }}</p>
        </div>
        <div class="bg-green-500 hover:bg-green-400 rounded-lg shadow-md p-6 text-center transition">
            <h3 class="text-xl font-semibold text-white">Expiring Soon</h3>
            <p class="text-4xl font-extrabold text-yellow-300">{{ expiring_soon|length }}</p>
        </div>
        <div class="bg-green-500 hover:bg-green-400 rounded-lg shadow-md p-6 text-center transition">
            <h3 class="text-xl font-semibold text-white">Total Recipes</h3>
            <p class="text-4xl font-extrabold text-yellow-300">{{ recipes|length }}</p>
        </div>
    </div>

    <!-- Expiring Soon Section -->
    <div>
        <h2 class="text-2xl font-semibold mb-6 text-green-600">Expiring Soon/Expired</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for food_item in expiring_soon %}
            <div class="bg-white rounded-lg shadow-md p-4">
                <h4 class="text-lg font-bold text-green-500">{{ food_item.name }}</h4>
                <p class="text-sm text-gray-700">Expires: {{ food_item.expiration_date }}</p>
                <a href="#" class="text-green-600 hover:text-yellow-400 mt-2 block transition">View Details</a>
            </div>
            {% empty %}
            <div class="bg-white rounded-lg shadow-md p-4 text-center">
                <p class="text-gray-500">No items expiring soon. Great job staying on top of things!</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Charts Section -->
    <div class="mt-12">
        <h2 class="text-2xl font-semibold mb-6 text-green-600">Statistics</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h4 class="text-lg font-semibold mb-4 text-center text-green-600">Expired vs. Non-Expired Items</h4>
                <canvas id="expiredChart" class="w-full h-64"></canvas>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h4 class="text-lg font-semibold mb-4 text-center text-green-600">Food Items by Priority</h4>
                <canvas id="priorityChart" class="w-full h-64"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
    // Data for Expired vs. Non-Expired Items
    const expiredData = {
        labels: ['Expired', 'Non-Expired'],
        datasets: [{
            data: [{{ expired_count }}, {{ non_expired_count }}],
            backgroundColor: ['#48BB78', '#A3E635'],
            hoverBackgroundColor: ['#38A169', '#84CC16']
        }]
    };

    const ctxExpired = document.getElementById('expiredChart').getContext('2d');
    new Chart(ctxExpired, {
        type: 'doughnut',
        data: expiredData,
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top', labels: { color: '#333' } }
            }
        }
    });

    // Data for Food Items by Priority
    const priorityLabels = [{% for item in priority_data %}'{{ item.priority|capfirst }}',{% endfor %}];
    const priorityCounts = [{% for item in priority_data %}{{ item.count }},{% endfor %}];
    const priorityData = {
        labels: priorityLabels,
        datasets: [{
            data: priorityCounts,
            backgroundColor: ['#34D399', '#10B981', '#059669'],
            hoverBackgroundColor: ['#059669', '#047857', '#065F46']
        }]
    };

    const ctxPriority = document.getElementById('priorityChart').getContext('2d');
    new Chart(ctxPriority, {
        type: 'bar',
        data: priorityData,
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                x: { title: { display: true, text: 'Priority Levels', color: '#333' } },
                y: { title: { display: true, text: 'Count', color: '#333' } }
            }
        }
    });
</script>
{% endblock %}
